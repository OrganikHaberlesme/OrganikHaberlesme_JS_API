function Organikapi(a){return this.API_KEY=a?a.API_KEY||null:null,this.HEADER_NAME=a?a.HEADER_NAME||null:null,this.MESSAGE=a?a.MESSAGE||null:null,this.HEADERS={},this.GROUPS={},this.GROUPIDS=a?a.GROUPIDS||null:null,this.GSMS=a?a.GSMS||null:null,this.TIMEOUT=a?a.TIMEOUT||48:48,this.DELIVERY_TIME=a?a.DELIVERY_TIME||null:null,this.TRACK_ID=a?a.TRACK_ID||null:null,this.REPORT_URL=a?a.REPORT_URL||null:null,this.IS_UNIQUE=a?a.IS_UNIQUE||1:1,this.MESSAGE_FORMAT=a?a.MESSAGE_FORMAT||0:0,this.CREDIT_BALANCE=0,this.TL_BALANCE=0,this.API_VERSION="v2/",this.API_URL="https://organikapi.com/",this.gMESSAGE="",this.IS_TEST=!!a&&(a.IS_TEST||!1),this.DEBUG_MODE=!!a&&(a.DEBUG_MODE||!1),this.PRESULT={},this.ui={isIE:!1,elems:{HEADER:{el:null,use:["smsviaget","sendsms"],apiname:"header"},GROUPIDS:{el:null,use:["smsviaget","sendsms","groups","groupcontent"],apiname:"groupids"},GSMS:{el:null,use:["smsviaget","sendsms","blacklistadd","blacklist","blacklistremove"],apiname:"gsms"},MESSAGE:{el:null,use:["smsviaget","sendsms"],apiname:"message"},MESSAGE_FORMAT:{el:null,use:["sendsms"],apiname:"message_format"},IS_UNIQUE:{el:null,use:["smsviaget","sendsms"],apiname:"gsm_isunique"},DELIVERY_TIME:{el:null,use:["smsviaget","sendsms"],apiname:"deliverytime"},TIMEOUT:{el:null,use:["smsviaget","sendsms"],apiname:"timeout"},TRACK_ID:{el:null,use:["smsviaget","sendsms"],apiname:"track_id"},REPORT_URL:{el:null,use:["smsviaget","sendsms"],apiname:"report_url"},SEND:{el:null,use:["smsviaget","sendsms"],apiname:null}}},this.rtypes={GET:["balance","headers","smsviaget","groups","blacklist"],POST:["sendsms","detailedreport","basicreport","groupcontent","cancelscheduledtasks","blacklistadd","blacklistremove"]},this.balance({async:!0,select:"balances"}),this.setUI(),this.f={cd:function(a){if(a){if(o.ui.isIE)var c=new Date(Date.parse(a));else{var b=a.replace("T"," "),c=new Date(b);c||(c=new Date(a))}var d=c.getDate(),e=c.getMonth()+1,f=c.getFullYear(),g=c.getHours(),h=c.getMinutes();return d=d<10?"0"+d:d,e=e<10?"0"+e:e,h=h<10?"0"+h:h,g=g<10?"0"+g:g,f+"-"+e+"-"+d+" "+g+":"+h}var c=new Date,d=c.getDate(),e=c.getMonth()+1,f=c.getFullYear(),g=c.getHours(),h=c.getMinutes();return d=d<10?"0"+d:d,e=e<10?"0"+e:e,h=h<10?"0"+h:h,g=g<10?"0"+g:g,f+"-"+e+"-"+d+" "+g+":"+h},clearType:function(){for(var a=[],b={},c=this.length,d=0;d<c;++d){var e=clearNumbers.setNumber(this[d]);e&&(b[this[d]]=e)}for(d in b)a.push(b[d]);return a}},this}Organikapi.prototype.debug=function(a){if(this.DEBUG_MODE)for(var b=0;b<a.length;b++)console[a[b][0]](a[b][1])},Organikapi.prototype.APIREQ=function(a,b){var c=this;try{if(c.API_KEY||32!==c.API_KEY.length){for(var d in a)if(/process|method|async/.test(d)&&"string"==typeof a[d]){var e=a[d].toString().trim();if(""==e||void 0==e||null==e)return c.gMESSAGE="Eksik ya da yanlış parametre tanımlaması: "+d,c.debug([["warn","API istek prosedürü, yanlış argüman uyarısı:"],["info",d]]),b&&b(!1),!1}if("json"!==a.responseType)return c.gMESSAGE="Yanıt gövdesi tipi parametresi hatalı",!1;if(window.XMLHttpRequest)var f=new XMLHttpRequest;else var f=new ActiveXObject("Microsoft.XMLHTTP");var g="boolean"!=typeof a.async||a.async;g&&(f.onreadystatechange=function(){if(f.readyState===XMLHttpRequest.DONE){if(200==f.status){if(b){var d="json"==a.responseType?f.response.response:f.responseText;return b(d),d}return d}return c.gMESSAGE="API isteği başarısız oldu ("+f.status+")",c.debug([["error","Başarısız API isteği ("+f.status+"). Şunlar talep edildi:"],["info",JSON.stringify(a)]]),!!b&&(b(!1),!1)}}),g&&(f.responseType=a.responseType);var h=c.rtypes.POST.indexOf(a.process)>-1?"POST":"GET",i="POST"==h&&a.data?JSON.stringify(a.data):null,j=c.API_URL+c.API_VERSION+c.API_KEY+"/"+a.process+"/";if("GET"==h&&a.data&&(j+="?"+a.data),f.open(h,j,g),f.send(i),!g){if(200===f.status){if(b){var k=JSON.parse(f.responseText);return b(k.response),k.response}return k.response}return c.gMESSAGE="API isteği başarısız oldu ("+f.status+")",c.debug([["error","Başarısız API isteği ("+f.status+"). Şunlar talep edildi:"],["info",JSON.stringify(a)]]),!!b&&(b(!1),!1)}}else c.debug([["warn","API istek prosedürü, yanlış argüman uyarısı:"],["info","API_KEY değeri boş ve 32 karakterden kısa/uzun olamaz"]]),b&&b(!1)}catch(a){c.gMESSAGE="API istek hatası: "+a,c.debug([["info","API istek hatası: "],["log",a]]),b&&b(!1)}},Organikapi.prototype.getAPIData=function(a,b){if(a)var c=a.select,d=a.async,e=a.method;var f=this;return f.APIREQ({process:e,responseType:"json",async:d},function(a){if(!a)return alert(f.gMESSAGE),!1;if(a.result)switch(e){case"groups":f.GROUPS=a;var g,d=document.getElementById(c);if(d){d.innerHTML="";for(var h=0;h<a.data.length;h++)g=document.createElement("option"),g.text=a.data[h].name+" ("+a.data[h].count+")",g.value=a.data[h].id,g.setAttribute("data-count",a.data[h].count),d.appendChild(g)}else if(f.ui.elems.GROUPIDS.el&&("select-one"==f.ui.elems.GROUPIDS.el.type||"select-multiple"===f.ui.elems.GROUPIDS.el.type)){f.ui.elems.GROUPIDS.el.innerHTML="";for(var h=0;h<a.data.length;h++)g=document.createElement("option"),g.text=a.data[h].name+" ("+a.data[h].count+")",g.value=a.data[h].id,g.setAttribute("data-count",a.data[h].count),f.ui.elems.GROUPIDS.el.appendChild(g)}b&&b(a);break;case"headers":f.HEADERS=a;var g,d=document.getElementById(c);if(d){d.innerHTML="";for(var h=0;h<a.data.length;h++)g=document.createElement("option"),g.text=a.data[h].name,g.value=a.data[h].id,d.appendChild(g)}else if(f.ui.elems.HEADER.el&&"select-one"===f.ui.elems.HEADER.el.type){f.ui.elems.HEADER.el.innerHTML="";for(var h=0;h<a.data.length;h++)g=document.createElement("option"),g.text=a.data[h].name,g.value=a.data[h].id,g.setAttribute("data-count",a.data[h].count),f.ui.elems.HEADER.el.appendChild(g)}b&&b(a);break;case"balance":f.CREDIT_BALANCE=parseInt(a.data.credit),f.TL_BALANCE=parseFloat(a.data.tl);var d=document.getElementById(c);d&&(d.innerText="Kredi: "+f.CREDIT_BALANCE+" SMS / TL: "+f.TL_BALANCE+" TL"),b&&b(a);break;case"blacklist":var g,d=document.getElementById(c);if(d){d.innerHTML="";for(var h=0;h<a.data.length;h++)g=document.createElement("option"),g.text=a.data[h].gsm,g.value=a.data[h].gsm,d.appendChild(g)}else if(f.ui.elems.GSMS.el&&("select-one"===f.ui.elems.GSMS.el.type||"select-multiple"===f.ui.elems.GSMS.el.type)){f.ui.elems.GSMS.el.innerHTML="";for(var h=0;h<a.data.length;h++)g=document.createElement("option"),g.text=a.data[h].gsm,g.value=a.data[h].gsm,f.ui.elems.GSMS.el.appendChild(g)}b&&b(a)}else f.debug([["group","API veri yükleme hatası:"],["info","İşlem: "+e],["info","Hata mesajı: "+a.error.message],["info","Hata kodu: "+a.error.code],["info","Hata numarası: "+a.error.number],["groupEnd",""]])})},Organikapi.prototype.headers=function(a,b){var c=this;if(a)a.method="headers",a.async=!!a.async&&a.async;else var a={method:"headers",async:!1};return c.getAPIData(a,b)},Organikapi.prototype.groups=function(a,b){var c=this;if(a)a.method="groups",a.async=!!a.async&&a.async;else var a={method:"groups",async:!1};return c.getAPIData(a,b)},Organikapi.prototype.balance=function(a,b){var c=this;if(a)a.method="balance",a.async=!!a.async&&a.async;else var a={method:"balance",async:!1};return c.getAPIData(a,b)},Organikapi.prototype.blacklist=function(a,b){var c=this;if(a)a.method="blacklist",a.async=!!a.async&&a.async;else var a={method:"blacklist",async:!1};return c.getAPIData(a,b)},Organikapi.prototype.clearCustomGSMs=function(){var a=document.querySelectorAll('[data-role="GSMS"]'),b=document.getElementById(a[0].id);if(b){var c=b.value;c&&(c=c.replace(/[^0-9\,\n]+/g,""),c=c.replace(/,/gi,"\n"),b.value=c)}else o.debug([["warn","GSMS nesnesi bulunamadı"]])},Organikapi.prototype.setUI=function(){var a=this,b=function(){for(var a,b=3,c=document.createElement("div"),d=c.getElementsByTagName("i");c.innerHTML="\x3c!--[if gt IE "+ ++b+"]><i></i><![endif]--\x3e",d[0];);return b>4?b:a}();a.ui.isIE=9==b||8==b||7==b||6==b||a.ui.isIE;var c=document.querySelectorAll('[data-role="GSMS"]');c[0]&&c[0].id&&"select-one"!==c[0].type&&"select-multiple"!==c[0].type&&document.getElementById(c[0].id).addEventListener("change",a.clearCustomGSMs);var d=document.querySelectorAll("[data-role]");for(a.debug([["groupCollapsed","API Form Nesnesi Algılandı"]]),i=0;i<d.length;i++)if(a.ui.elems[d[i].getAttribute("data-role")].el)a.debug([["warn","Form nesnesi daha önce atanmış: data-role: "+d[i].getAttribute("data-role")]]);else if(a.ui.elems[d[i].getAttribute("data-role")].el=d[i],a.debug([["info","Role: "+d[i].getAttribute("data-role")]]),a.debug([["info","Nesne: "+d[i]]]),a.debug([["info","ID: "+d[i].id]]),"SEND"==d[i].getAttribute("data-role"))if(d[i].id){var e=!!d[i].getAttribute("data-async")&&d[i].getAttribute("data-async");e="boolean"==typeof e&&e;var f=d[i].getAttribute("data-send")?d[i].getAttribute("data-send"):"sendsms";document.getElementById(d[i].id).addEventListener("click",function(){a.send({async:e,process:f})})}else a.debug([["info","Gönderim işlemi için form nesnesi tespit edilemedi."]]);a.debug([["groupEnd",""]])},Organikapi.prototype.checkBalance=function(){var a=this,b=0;if(a.GROUPIDS||a.GSMS){if(a.GROUPIDS){var c=a.GROUPIDS.split(",");for(i=0;i<c.length;i++)for(j=0;j<a.GROUPS.data.length;j++)if(c[i]==a.GROUPS.data[j].id){b+=a.GROUPS.data[j].count;break}}if(a.GSMS){b+=a.GSMS.split(",").length}return a.CREDIT_BALANCE>=b||(a.debug([["warn","İstenilen SMS gönderimi için yeterli kredi yok"]]),!1)}return a.debug([["info","Alıcılar olmadan kredi kontrolü yapılamaz."]]),!1},Organikapi.prototype.collectAPIDatas=function(a){var b=this;switch(Object.keys(b.ui.elems).forEach(function(c){if("SEND"!==c&&b.ui.elems[c].use.indexOf(a)>-1)switch(b.ui.elems[c].el.type){case"select-one":b[c]=b.ui.elems[c].el.options[b.ui.elems[c].el.selectedIndex].value?b.ui.elems[c].el.options[b.ui.elems[c].el.selectedIndex].value:null;break;case"select-multiple":var d=[];for(i=0;i<b.ui.elems[c].el.options.length;i++)opt=b.ui.elems[c].el.options[i],opt.selected&&d.push(opt.value);b[c]=d?d.toString():b[c];break;case"textarea":case"text":if("GSMS"!==c&&"GROUPIDS"!==c)b[c]="DELIVERY_TIME"!==c?b.ui.elems[c].el.value?b.ui.elems[c].el.value:b[c]:b.ui.elems[c].el.value?b.f.cd(b.ui.elems[c].el.value):b[c];else if(b.ui.elems[c].el.value){var e=b.ui.elems[c].el.value.replace(/[^0-9]+/g,","),f=e.split(",");b[c]=f.toString()}break;case"datetime-local":case"datetime":b[c]=b.ui.elems[c].el.value?b.f.cd(b.ui.elems[c].el.value):b[c];break;default:b[c]=b.ui.elems[c].el.value}}),a){case"smsviaget":case"sendsms":return b.MESSAGE&&(b.MESSAGE=window.btoa(unescape(encodeURIComponent(b.MESSAGE)))),!b.HEADER&&b.ui.elems.HEADER.use.indexOf(a)>-1?(b.debug([["warn","Gönderen kimliği (başlık) boş olamaz."]]),!1):!b.GSMS&&!b.GROUPIDS&&b.ui.elems.GSMS.use.indexOf(a)>-1&&b.ui.elems.GROUPIDS.use.indexOf(a)>-1?(b.debug([["warn","Alıcı grubu seçili değilken GSM numaraları boş olamaz."]]),!1):!(!b.MESSAGE&&b.ui.elems.MESSAGE.use.indexOf(a)>-1)||(b.debug([["warn","Mesaj metni boş olamaz."]]),!1);case"groupcontent":return!!b.GROUPIDS||(b.debug([["warn","Grup ID değeri boş olamaz."]]),!1);case"blacklistadd":return!!b.GSMS||(b.debug([["warn","Eklenecek numara yok."]]),!1);case"blacklistremove":return!!b.GSMS||(b.debug([["warn","Silinecek numara yok."]]),!1)}},Organikapi.prototype.send=function(a,b){var c=this,d="sendsms"==a.process?{}:"";if(c.ui.elems.SEND.el&&c.ui.elems.SEND.el.setAttribute("disabled","disabled"),!c.collectAPIDatas(a.process))return c.debug([["error","Gönderim işlemi gerçekleştirilemedi: Eksik ya da yanlış argüman."]]),c.ui.elems.SEND.el.removeAttribute("disabled"),!1;if(!c.checkBalance())return c.debug([["error","Gönderim işlemi gerçekleştirilemedi: Yetersiz bakiye."]]),c.ui.elems.SEND.el.removeAttribute("disabled"),!1;if(Object.keys(c.ui.elems).forEach(function(b){"SEND"!==b&&c.ui.elems[b].use.indexOf(a.process)>-1&&("smsviaget"==a.process?d=d?d+"&"+c.ui.elems[b].apiname+"="+c[b]:c.ui.elems[b].apiname+"="+c[b]:d[c.ui.elems[b].apiname]=c[b])}),"sendsms"==a.process){var e={data:{deliveries:[{options:{header:c.HEADER?parseInt(c.HEADER):null,delivery_time:c.DELIVERY_TIME,timeout:c.TIMEOUT?parseInt(c.TIMEOUT):null,message_format:c.MESSAGE_FORMAT?parseInt(c.MESSAGE_FORMAT):null,gsm_isUnique:c.IS_UNIQUE?parseInt(c.IS_UNIQUE):null,track_id:c.TRACK_ID,report_url:c.REPORT_URL},recipients:{groups:c.GROUPIDS.split(","),gsms:c.GSMS.split(",")},message:c.MESSAGE}]}};d=e}if(!c.IS_TEST)return c.APIREQ({process:a.process,responseType:"json",async:a.async,data:d},function(d){if(c.PRESULT=d,d.result){var e=d.data.deliveries.length,h=d.result?"Sağlandı":"Sağlanamadı";for(i=0;i<e;i++)c.debug([["group","SMS Gönderimi Sonuçları"]]),c.debug([["info","API İletişimi: "+h],["info","Toplam Gönderim İşlemi: "+e],["info","Gönderim ID: "+d.data.deliveries[i].transaction_id],["info","Başarılı Gönderim Sayısı: "+d.data.deliveries[i].valid.length],["info","Başarısız Gönderim Sayısı: "+d.data.deliveries[i].invalid.length]]),c.debug([["groupEnd",null]]);a.update_balance&&c.balance({async:!0,select:"balances"}),c.ui.elems.SEND.el&&c.ui.elems.SEND.el.removeAttribute("disabled"),b&&b(d)}else c.debug([["group","Hatalı API Sonucu:"]]),c.debug([["info","Mesaj: "+d.error.message],["info","Hata Kodu: "+d.error.code],["info","Hata Numarası: "+d.error.number]]),c.debug([["groupEnd",null]])});c.debug([["info","Sanal gönderim onaylandı."]]),c.ui.elems.SEND.el.removeAttribute("disabled")},Organikapi.prototype.smsviaget=function(a,b){var c=this;return b="function"==typeof a?a:b||null,a.async=!!a&&(!!a.async&&a.async),a.update_balance=!!a&&(!!a.update_balance&&a.update_balance),a.process="smsviaget",c.send(a,b)},Organikapi.prototype.sendsms=function(a,b){var c=this;return b="function"==typeof a?a:b||null,a.async=!!a&&(!!a.async&&a.async),a.update_balance=!!a&&(!!a.update_balance&&a.update_balance),a.process="sendsms",c.send(a,b)},Organikapi.prototype.groupcontent=function(a,b){var c=this,d=a?a.group_ids:[],e=!!a&&(!!a.async&&a.async);return b="function"==typeof a?a:b||null,"object"==typeof d?d.length>0?c.GROUPIDS=d.toString():c.collectAPIDatas("groupcontent")&&(d=c.GROUPIDS):d?c.GROUPIDS=d.replace(/[^0-9]+/g,","):c.collectAPIDatas("groupcontent")&&(d=c.GROUPIDS),d?c.APIREQ({process:"groupcontent",responseType:"json",async:e,data:{data:{group_ids:c.GROUPIDS.split(",")}}},function(a){b&&b(a)}):(c.debug([["warn","İçeriği istenecek bir grup bulunamadı."]]),!1)},Organikapi.prototype.blacklistadd=function(a,b){var c=this,d=a?a.gsms:[],e=!!a&&(!!a.async&&a.async);return b="function"==typeof a?a:b||null,"object"==typeof d?d.length>0?c.GSMS=d.toString():c.collectAPIDatas("blacklistadd")&&(d=c.GSMS):d?c.GSMS=d.replace(/[^0-9]+/g,","):c.collectAPIDatas("blacklistadd")&&(d=c.GSMS),d?c.APIREQ({process:"blacklistadd",responseType:"json",async:e,data:{data:{gsms:c.GSMS.split(",")}}},function(a){b&&b(a)}):(c.debug([["warn","Eklenecek bir numara bulunamadı."]]),!1)},Organikapi.prototype.blacklistremove=function(a,b){var c=this,d=a?a.gsms:[],e=!!a&&(!!a.async&&a.async);return b="function"==typeof a?a:b||null,"object"==typeof d?d.length>0?c.GSMS=d.toString():c.collectAPIDatas("blacklistremove")&&(d=c.GSMS):d?c.GSMS=d.replace(/[^0-9]+/g,","):c.collectAPIDatas("blacklistadd")&&(d=c.GSMS),d?c.APIREQ({process:"blacklistremove",responseType:"json",async:e,data:{data:{gsms:c.GSMS.split(",")}}},function(a){b&&b(a)}):(c.debug([["warn","Silinecek bir numara bulunamadı."]]),!1)},Organikapi.prototype.basicreport=function(a,b){var c=this,d=a?a.delivery_track_ids:[],e=a?a.transaction_ids:[],f=a?a.gsm_track_ids:[],g=!!a&&(!!a.async&&a.async),h=[];b="function"==typeof a?a:b||null,d="object"!=typeof d?d.replace(/[^0-9]+/g,","):d.toString(),e="object"!=typeof e?e.replace(/[^0-9]+/g,","):e.toString(),f="object"!=typeof f?f.split(","):f;for(var i=0;i<f.length;i++)/[((\d{1,11})\-(\d{1,6})\-(\d{1,20}))]/.test(f[i])&&h.push(f[i]);return d||e||f?c.APIREQ({process:"basicreport",responseType:"json",async:g,data:{data:{delivery_track_ids:d.split(","),transaction_ids:e.split(","),gsm_track_ids:h}}},function(a){b&&b(a)}):(c.debug([["warn","Rapor çekmek için en az bir parametreyi göndermelisiniz."]]),!1)},Organikapi.prototype.detailedreport=function(a,b){var c=this,d=a?a.delivery_track_ids:[],e=a?a.transaction_ids:[],f=a?a.gsm_track_ids:[],g=!!a&&(!!a.async&&a.async),h=[];b="function"==typeof a?a:b||null,d="object"!=typeof d?d.replace(/[^0-9]+/g,","):d.toString(),e="object"!=typeof e?e.replace(/[^0-9]+/g,","):e.toString(),f="object"!=typeof f?f.split(","):f;for(var i=0;i<f.length;i++)/[((\d{1,11})\-(\d{1,6})\-(\d{1,20}))]/.test(f[i])&&h.push(f[i]);return d||e||f?c.APIREQ({process:"detailedreport",responseType:"json",async:g,data:{data:{delivery_track_ids:d.split(","),transaction_ids:e.split(","),gsm_track_ids:h}}},function(a){b&&b(a)}):(c.debug([["warn","Rapor çekmek için en az bir parametreyi göndermelisiniz."]]),!1)};